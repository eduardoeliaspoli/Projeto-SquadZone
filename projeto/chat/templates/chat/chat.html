<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Chat com Pusher</title>
    <script src="https://js.pusher.com/7.0/pusher.min.js"></script>
</head>
<style>
    body {
        background-color: rgba(0, 0, 0);
    }

    #messages {
        background-color: rgb(0, 0, 0);
        color: magenta;
    }

    #messageInput {
        color: darkmagenta;
    }

    #sendButton {
        background-color: rgb(157, 11, 255);
    }

    #username {
        background-color: rgb(0, 0, 0);

    }
</style>

<body>


    <div id="chat"></div>
    <input type="text" id="nome_usuario" placeholder="Seu nome" />
    <input type="text" id="mensagem" placeholder="Sua mensagem" />
    <button id="enviar">Enviar</button>


    <script>
        const pusher = new Pusher('067e31123de297cc050e', {
            cluster: 'sa1'
        });

        const canal = pusher.subscribe('chat');
        canal.bind('mensagem', function (data) {
            const chat = document.getElementById('chat');
            chat.innerHTML += `<p><strong>${data.nome_usuario}:</strong> ${data.mensagem}</p>`;
        });

        document.getElementById('enviar').onclick = function () {
            const nome_usuario = document.getElementById('nome_usuario').value;
            const mensagem = document.getElementById('mensagem').value;

            fetch('/send_message/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': '{{ csrf_token }}'  // Proteção CSRF
                },
                body: `nome_usuario=${nome_usuario}&mensagem=${mensagem}`
            });

            document.getElementById('mensagem').value = ''; // Limpa o campo de mensagem
        };

        // Remover a parte que carrega o histórico de mensagens
    </script>

</body>

</html>